<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calendario Competencias 2026</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700;900&family=Teko:wght@500;700&display=swap" rel="stylesheet">
    
    <style>
        body {
            font-family: 'Montserrat', sans-serif;
            background-color: #0f172a; /* Slate 900 */
            color: white;
            overflow-x: hidden;
        }
        .font-display {
            font-family: 'Teko', sans-serif;
        }
        
        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #1e293b; 
        }
        ::-webkit-scrollbar-thumb {
            background: #475569; 
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #64748b; 
        }

        /* Branding Gradients & Styles */
        .brand-wodstock {
            background: linear-gradient(135deg, #0284c7 0%, #38bdf8 100%);
            border-left: 5px solid #bae6fd;
        }
        .cal-bg-wodstock { background-color: #0284c7; color: white; }
        
        .brand-kilo {
            background: linear-gradient(135deg, #b91c1c 0%, #ef4444 100%);
            border-left: 5px solid #fca5a5;
        }
        .cal-bg-kilo { background-color: #dc2626; color: white; }

        .brand-strongfit {
            background: linear-gradient(135deg, #334155 0%, #475569 100%);
            border-left: 5px solid #cbd5e1;
        }
        .cal-bg-strongfit { background-color: #475569; color: white; }

        /* BRAND FRENTE PAINE (Navy & Pink) */
        .brand-frente {
            background: linear-gradient(135deg, #111827 0%, #1f2937 100%); /* Dark Navy */
            border-left: 5px solid #ec4899; /* Pink */
        }
        .cal-bg-frente { background-color: #ec4899; color: white; }

        /* Checkerboard pattern */
        .bg-checker {
            background-image: repeating-linear-gradient(45deg, #000 25%, transparent 25%, transparent 75%, #000 75%, #000), repeating-linear-gradient(45deg, #000 25%, transparent 25%, transparent 75%, #000 75%, #000);
            background-position: 0 0, 10px 10px;
            background-size: 20px 20px;
            opacity: 0.15;
        }

        .timeline-line {
            position: absolute;
            left: 20px;
            top: 0;
            bottom: 0;
            width: 4px;
            background: #334155;
            z-index: 0;
            border-radius: 2px;
        }
        @media (min-width: 768px) {
            .timeline-line {
                left: 50%;
                transform: translateX(-50%);
            }
        }

        /* Calendar Styles */
        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 4px;
        }
        .calendar-day {
            min-height: 80px;
            position: relative;
            transition: all 0.2s;
        }
        .calendar-day:hover {
            background-color: #1e293b;
        }
        .event-bar {
            font-size: 10px;
            padding: 2px 4px;
            margin-top: 2px;
            border-radius: 2px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            cursor: pointer;
            font-weight: bold;
        }
    </style>
</head>
<body class="min-h-screen flex flex-col">

    <!-- Navbar -->
    <nav class="bg-slate-900/90 backdrop-blur-md border-b border-slate-800 sticky top-0 z-50 shadow-2xl">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex flex-col md:flex-row items-center justify-between h-auto md:h-16 py-2 md:py-0 gap-3 md:gap-0">
                <div class="flex items-center gap-3">
                    <div class="bg-yellow-500 rounded p-1">
                        <i class="fa-solid fa-calendar-days text-slate-900 text-xl"></i>
                    </div>
                    <span class="font-display text-2xl md:text-3xl tracking-wide font-bold text-white leading-none mt-1">CALENDARIO <span class="text-slate-400">2026</span></span>
                </div>
                
                <div class="flex flex-col md:flex-row items-center gap-3 w-full md:w-auto">
                    <!-- View Switcher -->
                    <div class="bg-slate-800 p-1 rounded-lg flex border border-slate-700">
                        <button onclick="switchView('list')" id="view-list-btn" class="px-4 py-1.5 rounded-md text-xs font-bold transition flex items-center gap-2 bg-slate-600 text-white shadow">
                            <i class="fa-solid fa-list-ul"></i> Lista
                        </button>
                        <button onclick="switchView('calendar')" id="view-calendar-btn" class="px-4 py-1.5 rounded-md text-xs font-bold transition flex items-center gap-2 text-slate-400 hover:text-white">
                            <i class="fa-regular fa-calendar"></i> Mes
                        </button>
                    </div>

                    <!-- Filters Desktop -->
                    <div class="hidden md:flex bg-slate-800 p-1 rounded-lg border border-slate-700">
                        <button onclick="filterEvents('all')" id="btn-all" class="filter-btn bg-white text-slate-900 px-3 py-1.5 rounded text-xs font-bold transition">TODAS</button>
                        <button onclick="filterEvents('open')" id="btn-open" class="filter-btn text-slate-400 px-3 py-1.5 rounded text-xs font-bold transition hover:text-white">OPENS</button>
                        <button onclick="filterEvents('final')" id="btn-final" class="filter-btn text-slate-400 px-3 py-1.5 rounded text-xs font-bold transition hover:text-white">FINALES</button>
                    </div>
                </div>
            </div>
        </div>
        <!-- Mobile Filters -->
        <div class="md:hidden flex justify-around py-2 bg-slate-800 border-t border-slate-700">
            <button onclick="filterEvents('all')" class="text-[10px] font-bold text-white bg-slate-700 px-3 py-1 rounded border border-slate-600">TODO</button>
            <button onclick="filterEvents('open')" class="text-[10px] font-bold text-slate-400 px-3 py-1">OPENS</button>
            <button onclick="filterEvents('final')" class="text-[10px] font-bold text-slate-400 px-3 py-1">FINALES</button>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="flex-grow container mx-auto px-4 py-6 relative">

        <div class="text-center mb-6 md:mb-10">
            <h1 class="text-3xl md:text-5xl font-display font-bold text-white mb-2">TEMPORADA 2026</h1>
            <p class="text-slate-400 text-xs md:text-sm max-w-lg mx-auto">Calendario unificado. Haz clic en un evento para ver detalles y agregar a tu agenda.</p>
        </div>
        
        <!-- LIST VIEW -->
        <div class="relative max-w-5xl mx-auto pb-20" id="list-view-container">
            <div class="timeline-line"></div>
        </div>

        <!-- CALENDAR VIEW -->
        <div class="hidden max-w-6xl mx-auto pb-20" id="calendar-view-container">
            <div class="flex items-center justify-between mb-6 bg-slate-800 p-4 rounded-xl border border-slate-700 shadow-lg">
                <button onclick="changeMonth(-1)" class="w-10 h-10 rounded-full bg-slate-700 hover:bg-slate-600 text-white flex items-center justify-center transition">
                    <i class="fa-solid fa-chevron-left"></i>
                </button>
                <div class="text-center">
                    <h2 id="calendar-month-year" class="text-2xl font-display font-bold text-white uppercase tracking-wider"></h2>
                </div>
                <button onclick="changeMonth(1)" class="w-10 h-10 rounded-full bg-slate-700 hover:bg-slate-600 text-white flex items-center justify-center transition">
                    <i class="fa-solid fa-chevron-right"></i>
                </button>
            </div>
            <div class="grid grid-cols-7 gap-4 mb-2 text-center">
                <div class="text-slate-500 text-xs font-bold uppercase">Lun</div>
                <div class="text-slate-500 text-xs font-bold uppercase">Mar</div>
                <div class="text-slate-500 text-xs font-bold uppercase">Mi√©</div>
                <div class="text-slate-500 text-xs font-bold uppercase">Jue</div>
                <div class="text-slate-500 text-xs font-bold uppercase">Vie</div>
                <div class="text-slate-500 text-xs font-bold uppercase text-yellow-500">S√°b</div>
                <div class="text-slate-500 text-xs font-bold uppercase text-yellow-500">Dom</div>
            </div>
            <div id="calendar-grid" class="calendar-grid bg-slate-800 border border-slate-700 rounded-xl overflow-hidden p-1"></div>
        </div>
    </main>

    <footer class="bg-slate-950 border-t border-slate-900 py-8 text-center text-slate-500 text-sm">
        <p class="font-display text-xl text-slate-300 mb-2">CALENDARIO CROSSFIT CHILE</p>
        <p class="text-xs opacity-60">Las fechas tentativas est√°n sujetas a cambios por los organizadores.</p>
    </footer>

    <!-- MODAL -->
    <div id="modal" class="fixed inset-0 bg-black/90 z-[100] hidden flex items-center justify-center p-4 backdrop-blur-sm transition-opacity duration-300">
        <div class="bg-slate-800 rounded-2xl max-w-lg w-full p-0 shadow-2xl border border-slate-700 relative overflow-hidden transform scale-95 transition-transform duration-300 flex flex-col max-h-[90vh]" id="modal-panel">
            
            <div id="modal-header" class="p-6 relative shrink-0">
                <div class="absolute inset-0 bg-checker opacity-10 pointer-events-none"></div>
                <button onclick="closeModal()" class="absolute top-4 right-4 text-white/70 hover:text-white bg-black/20 hover:bg-black/40 rounded-full w-8 h-8 flex items-center justify-center transition z-20">
                    <i class="fa-solid fa-xmark"></i>
                </button>
                <div class="relative z-10">
                    <span id="modal-type" class="text-xs font-bold uppercase tracking-widest text-white/80 mb-1 block"></span>
                    <h2 id="modal-title" class="font-display text-3xl md:text-4xl text-white uppercase leading-none shadow-black drop-shadow-md"></h2>
                    <p id="modal-org" class="font-bold text-white/90 text-lg mt-1 flex items-center gap-2"></p>
                </div>
            </div>

            <div class="p-6 space-y-4 overflow-y-auto">
                <!-- Info Grid -->
                <div class="flex gap-4 mb-2">
                    <div class="flex-1 bg-slate-700/50 p-3 rounded-lg border border-slate-600">
                        <span class="block text-slate-400 text-[10px] uppercase font-bold tracking-wider mb-1">FECHA</span>
                        <div id="modal-date" class="text-white font-bold text-sm"></div>
                    </div>
                    <div class="flex-1 bg-slate-700/50 p-3 rounded-lg border border-slate-600">
                        <span class="block text-slate-400 text-[10px] uppercase font-bold tracking-wider mb-1">UBICACI√ìN</span>
                        <div id="modal-location" class="text-white font-bold text-sm"></div>
                    </div>
                </div>

                <div class="bg-slate-900/50 p-4 rounded-lg border border-slate-700/50">
                    <p id="modal-desc" class="text-slate-300 text-sm italic mb-3"></p>
                    <div class="h-px bg-slate-700 w-full mb-3"></div>
                    <p id="modal-details" class="text-xs text-slate-400 leading-relaxed"></p>
                </div>

                <!-- Web Actions -->
                <div class="grid grid-cols-2 gap-3 pt-2">
                    <a id="modal-ig-link" href="#" target="_blank" class="flex items-center justify-center gap-2 py-3 rounded-lg font-bold bg-slate-700 text-white hover:bg-pink-600 transition group text-sm">
                        <i class="fa-brands fa-instagram text-lg"></i> Instagram
                    </a>
                    <a id="modal-action-link" href="#" target="_blank" class="flex items-center justify-center gap-2 py-3 rounded-lg font-bold text-white shadow-lg transition transform hover:-translate-y-0.5 text-sm">
                        <span>Ver Web</span> <i class="fa-solid fa-arrow-right"></i>
                    </a>
                </div>

                <!-- Calendar Actions -->
                 <div class="pt-4 border-t border-slate-700">
                    <p class="text-[10px] font-bold text-slate-500 uppercase tracking-widest mb-2 text-center">Guardar Fecha</p>
                    <div class="grid grid-cols-2 gap-3">
                        <button onclick="addToGoogleCalendar()" class="flex items-center justify-center gap-2 py-2.5 rounded-lg font-bold bg-white text-slate-900 hover:bg-slate-200 transition text-xs border border-slate-300">
                            <i class="fa-brands fa-google text-blue-500"></i> Google Cal
                        </button>
                        <button onclick="downloadICS()" class="flex items-center justify-center gap-2 py-2.5 rounded-lg font-bold bg-slate-600 text-white hover:bg-slate-500 transition text-xs border border-slate-500">
                            <i class="fa-brands fa-apple"></i> Apple / .ics
                        </button>
                    </div>
                 </div>
            </div>
        </div>
    </div>

    <script>
        // --- DATA ---
        const events = [
            {
                id: 1,
                org: "Kilo Team Throwdown",
                title: "Inicio Inscripciones",
                dateStart: new Date(2026, 1, 4), 
                dateEnd: new Date(2026, 1, 4), 
                type: "inscripcion",
                brand: "kilo",
                desc: "Apertura oficial de inscripciones Kilo.",
                location: "Online",
                link: "https://www.instagram.com/teamthrowdown_cl?igsh=aDlqdGp1ZHB6b2x4", 
                ig: "https://www.instagram.com/teamthrowdown_cl?igsh=aDlqdGp1ZHB6b2x4",
                details: "Categor√≠as: Duplas e Indy. Niveles: Rookie, Scaled, Master, RX, Elite.",
                isTentative: false
            },
            {
                id: 2,
                org: "Wodstock Chile",
                title: "Open Clasificatorio",
                dateStart: new Date(2026, 1, 26), 
                dateEnd: new Date(2026, 2, 16),
                type: "open",
                brand: "wodstock",
                desc: "Winter Edition 2026 - Proceso Online.",
                location: "Online (BoxPodium)",
                link: "https://boxpodium.com/en/event/69702f361d206b6bcdee39c5",
                ig: "https://www.instagram.com/wodstockchile?igsh=NGFjcjU4azJrc2h6",
                details: "Clasificatorio obligatorio. 3 WODs. Inscr√≠bete en BoxPodium.",
                isTentative: false
            },
            {
                id: 3,
                org: "Competencia Abierta",
                title: "Frente Paine üçâ", 
                dateStart: new Date(2026, 2, 14), 
                dateEnd: new Date(2026, 2, 14),
                type: "final",
                brand: "frente",
                desc: "Competencia Presencial Categor√≠a Scaled.",
                location: "Paine, RM",
                link: "https://facewod.com/competition/226", 
                ig: "https://www.instagram.com/frente.paine/",
                details: "Categor√≠a Scaled (Hombres/Mujeres). Gimnasia: Pull ups/C2B, HSPU (<10), T2B. Pesos: Snatch (50/25), C&J (60/35).",
                isTentative: false
            },
            {
                id: 4,
                org: "Kilo Team Throwdown",
                title: "FINAL PRESENCIAL",
                dateStart: new Date(2026, 3, 11),
                dateEnd: new Date(2026, 3, 12),
                type: "final",
                brand: "kilo",
                desc: "Speedway Throwdown 26'.",
                location: "Chile",
                link: "https://www.instagram.com/p/DT_kSlFiUwA",
                ig: "https://www.instagram.com/teamthrowdown_cl?igsh=aDlqdGp1ZHB6b2x4",
                details: "Duplas al l√≠mite. All gas. No Limits. Competencia presencial sin open previo para duplas.",
                isTentative: false
            },
            {
                id: 5,
                org: "Strongfit Games",
                title: "Open Online",
                dateStart: new Date(2026, 4, 5),
                dateEnd: new Date(2026, 4, 15),
                type: "open",
                brand: "strongfit",
                desc: "Clasificatorio Latam Games.",
                location: "Online",
                link: "https://www.instagram.com/strongfitgames_latam",
                ig: "https://www.instagram.com/strongfitgames_latam?igsh=MjZyZmJ6bmVweWd1",
                details: "Fechas estimadas basadas en la temporada anterior (Mayo).",
                isTentative: true
            },
            {
                id: 6,
                org: "Strongfit Games",
                title: "GRAN FINAL",
                dateStart: new Date(2026, 5, 20),
                dateEnd: new Date(2026, 5, 22),
                type: "final",
                brand: "strongfit",
                desc: "Final Presencial Latam Games.",
                location: "Presencial",
                link: "https://www.instagram.com/strongfitgames_latam",
                ig: "https://www.instagram.com/strongfitgames_latam?igsh=MjZyZmJ6bmVweWd1",
                details: "Fecha tentativa para Junio 2026. Pendiente confirmaci√≥n oficial.",
                isTentative: true
            },
            {
                id: 7,
                org: "Wodstock Chile",
                title: "WINTER EDITION",
                dateStart: new Date(2026, 6, 24),
                dateEnd: new Date(2026, 6, 26),
                type: "final",
                brand: "wodstock",
                desc: "Fitness Festival - Final Presencial.",
                location: "Santiago, Chile",
                link: "https://boxpodium.com/en/event/69702f361d206b6bcdee39c5",
                ig: "https://www.instagram.com/wodstockchile?igsh=NGFjcjU4azJrc2h6",
                details: "La gran fiesta del fitness de invierno. Auspiciador Oficial: HWM.",
                isTentative: false
            }
        ];

        // --- STATE ---
        let currentFilter = 'all';
        let currentView = 'list';
        let calendarDate = new Date(2026, 1, 1);
        let selectedEvent = null; // Store for modal actions

        // --- FORMATTERS ---
        const monthsShort = ["ENE", "FEB", "MAR", "ABR", "MAY", "JUN", "JUL", "AGO", "SEP", "OCT", "NOV", "DIC"];
        const fullMonths = ["Enero", "Febrero", "Marzo", "Abril", "Mayo", "Junio", "Julio", "Agosto", "Septiembre", "Octubre", "Noviembre", "Diciembre"];

        function formatDateShort(date) {
            return `${date.getDate()} ${monthsShort[date.getMonth()]}`;
        }
        function formatDateLong(date) {
            return `${date.getDate()} de ${fullMonths[date.getMonth()]}, ${date.getFullYear()}`;
        }
        
        // --- CALENDAR LOGIC (ICS/Google) ---
        function formatICSDate(date) {
            return date.toISOString().replace(/-|:|\.\d\d\d/g, "").slice(0, 15) + "Z";
        }

        function addToGoogleCalendar() {
            if(!selectedEvent) return;
            const start = formatICSDate(selectedEvent.dateStart);
            const end = selectedEvent.dateEnd ? formatICSDate(new Date(selectedEvent.dateEnd.getTime() + 86400000)) : start; // +1 day for all-day logic
            
            const text = encodeURIComponent(`${selectedEvent.title} - ${selectedEvent.org}`);
            const details = encodeURIComponent(`${selectedEvent.desc}\n\n${selectedEvent.details}\nLink: ${selectedEvent.link}`);
            const location = encodeURIComponent(selectedEvent.location);
            
            const url = `https://calendar.google.com/calendar/render?action=TEMPLATE&text=${text}&dates=${start}/${end}&details=${details}&location=${location}&sf=true&output=xml`;
            window.open(url, '_blank');
        }

        function downloadICS() {
            if(!selectedEvent) return;
            const start = formatICSDate(selectedEvent.dateStart);
            const end = selectedEvent.dateEnd ? formatICSDate(new Date(selectedEvent.dateEnd.getTime() + 86400000)) : start;

            const icsContent = `BEGIN:VCALENDAR
VERSION:2.0
PRODID:-//CrossfitCalendar//CL//EN
BEGIN:VEVENT
UID:${selectedEvent.id}@crossfitcalendar.cl
DTSTAMP:${formatICSDate(new Date())}
DTSTART:${start}
DTEND:${end}
SUMMARY:${selectedEvent.title} - ${selectedEvent.org}
DESCRIPTION:${selectedEvent.desc} \\n ${selectedEvent.details} \\n ${selectedEvent.link}
LOCATION:${selectedEvent.location}
END:VEVENT
END:VCALENDAR`;

            const blob = new Blob([icsContent], { type: 'text/calendar;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            link.setAttribute('download', `${selectedEvent.org.replace(/\s/g,'_')}_${selectedEvent.type}.ics`);
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        // --- RENDERERS ---
        function getBrandConfig(brand) {
            switch(brand) {
                case 'wodstock': return { class: 'brand-wodstock', btn: 'bg-sky-600 hover:bg-sky-500', icon: 'fa-snowflake', calBg: 'cal-bg-wodstock' };
                case 'kilo': return { class: 'brand-kilo', btn: 'bg-red-600 hover:bg-red-500', icon: 'fa-flag-checkered', calBg: 'cal-bg-kilo' };
                case 'strongfit': return { class: 'brand-strongfit', btn: 'bg-slate-600 hover:bg-slate-500', icon: 'fa-dumbbell', calBg: 'cal-bg-strongfit' };
                case 'frente': return { class: 'brand-frente', btn: 'bg-pink-600 hover:bg-pink-500', icon: 'fa-umbrella-beach', calBg: 'cal-bg-frente' };
                default: return { class: 'bg-slate-700', btn: 'bg-slate-600', icon: 'fa-circle', calBg: 'bg-slate-600' };
            }
        }

        function shouldShowEvent(evt) {
            if (currentFilter === 'all') return true;
            if (currentFilter === 'open') return evt.type === 'open' || evt.type === 'inscripcion';
            if (currentFilter === 'final') return evt.type === 'final';
            return false;
        }

        function renderListView() {
            const container = document.getElementById('list-view-container');
            container.innerHTML = '<div class="timeline-line"></div>'; 

            const sortedEvents = events.sort((a, b) => a.dateStart - b.dateStart);
            let visibleCount = 0;

            sortedEvents.forEach((evt) => {
                if (!shouldShowEvent(evt)) return;
                visibleCount++;
                const isLeft = visibleCount % 2 !== 0;
                
                let dateDisplay = formatDateShort(evt.dateStart);
                if (evt.dateEnd && evt.dateStart.getTime() !== evt.dateEnd.getTime()) {
                    if (evt.dateStart.getMonth() === evt.dateEnd.getMonth()) {
                        dateDisplay = `${evt.dateStart.getDate()} - ${evt.dateEnd.getDate()} ${monthsShort[evt.dateStart.getMonth()]}`;
                    } else {
                        dateDisplay += ` - ${formatDateShort(evt.dateEnd)}`;
                    }
                }

                const tentativeBadge = evt.isTentative 
                    ? `<span class="bg-yellow-400 text-slate-900 text-[10px] font-black px-1.5 py-0.5 rounded ml-2 shadow-sm tracking-wide">ESTIMADO</span>` 
                    : '';
                const brandCfg = getBrandConfig(evt.brand);
                const pattern = evt.brand === 'kilo' ? '<div class="absolute inset-0 bg-checker z-0"></div>' : '';

                const html = `
                <div class="relative z-10 flex items-center justify-between w-full mb-10 ${isLeft ? 'md:flex-row' : 'md:flex-row-reverse'} flex-row-reverse group">
                    <div class="hidden md:block w-5/12"></div>
                    <div class="absolute left-[20px] md:left-1/2 transform -translate-x-1/2 w-10 h-10 rounded-full border-4 border-slate-900 bg-white flex items-center justify-center text-slate-900 text-xs font-black z-20 shadow-xl group-hover:scale-110 transition-transform duration-300">
                        ${evt.dateStart.getMonth() + 1}
                    </div>
                    <div class="w-[calc(100%-60px)] md:w-5/12 ml-auto md:ml-0 px-2">
                        <div onclick="openModal(${evt.id})" class="cursor-pointer transform transition-all duration-300 hover:scale-[1.03] hover:shadow-2xl relative overflow-hidden rounded-xl shadow-lg ${brandCfg.class}">
                            ${pattern}
                            <div class="relative z-10 p-5">
                                <div class="flex justify-between items-start mb-1 opacity-90">
                                    <div class="flex flex-col">
                                        <span class="text-[10px] font-bold uppercase tracking-widest text-white/80 mb-1 flex items-center">
                                            ${evt.type === 'final' ? 'üèÜ' : 'üíª'} ${evt.type}
                                        </span>
                                        <h3 class="font-display text-3xl text-white uppercase font-bold leading-none drop-shadow-md">
                                            ${evt.title}
                                        </h3>
                                    </div>
                                    <i class="fa-solid ${brandCfg.icon} text-white/20 text-4xl absolute top-2 right-2"></i>
                                </div>
                                <p class="text-xs font-bold text-white/90 mb-4 uppercase tracking-wide flex items-center border-b border-white/20 pb-2">
                                    ${evt.org} ${tentativeBadge}
                                </p>
                                <div class="flex items-center justify-between">
                                    <div class="flex items-center text-sm font-bold bg-black/30 px-3 py-1.5 rounded backdrop-blur-sm text-white">
                                        <i class="fa-regular fa-calendar mr-2 opacity-80"></i>
                                        ${dateDisplay}
                                    </div>
                                    <span class="bg-white/20 p-1.5 rounded-full hover:bg-white/40 transition">
                                        <i class="fa-solid fa-plus text-white text-xs"></i>
                                    </span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>`;
                container.insertAdjacentHTML('beforeend', html);
            });
        }

        function renderCalendar() {
            const grid = document.getElementById('calendar-grid');
            const monthLabel = document.getElementById('calendar-month-year');
            grid.innerHTML = '';
            
            const year = calendarDate.getFullYear();
            const month = calendarDate.getMonth();
            monthLabel.innerText = `${fullMonths[month]} ${year}`;

            const firstDay = new Date(year, month, 1);
            const lastDay = new Date(year, month + 1, 0);
            const daysInMonth = lastDay.getDate();
            let startDay = firstDay.getDay() - 1; 
            if (startDay === -1) startDay = 6; 

            for (let i = 0; i < startDay; i++) {
                grid.innerHTML += `<div class="bg-slate-900/50"></div>`;
            }

            for (let d = 1; d <= daysInMonth; d++) {
                const currentDayDate = new Date(year, month, d);
                const dayEvents = events.filter(evt => {
                    if (!shouldShowEvent(evt)) return false;
                    const eStart = new Date(evt.dateStart.getFullYear(), evt.dateStart.getMonth(), evt.dateStart.getDate());
                    const eEnd = evt.dateEnd ? new Date(evt.dateEnd.getFullYear(), evt.dateEnd.getMonth(), evt.dateEnd.getDate()) : eStart;
                    return currentDayDate >= eStart && currentDayDate <= eEnd;
                });

                let eventHtml = '';
                dayEvents.forEach(evt => {
                    const cfg = getBrandConfig(evt.brand);
                    eventHtml += `<div onclick="openModal(${evt.id}); event.stopPropagation();" class="event-bar ${cfg.calBg} text-white shadow hover:opacity-90">
                        ${evt.type === 'inscripcion' ? 'üìù' : evt.type === 'final' ? 'üèÜ' : 'üíª'} ${evt.org}
                    </div>`;
                });

                grid.innerHTML += `<div class="calendar-day bg-slate-800 border border-slate-700/50 p-1">
                    <div class="text-right text-xs font-bold ${dayEvents.length > 0 ? 'text-white' : 'text-slate-500'} mb-1">${d}</div>
                    <div class="flex flex-col gap-1">${eventHtml}</div>
                </div>`;
            }
        }

        function changeMonth(delta) {
            calendarDate.setMonth(calendarDate.getMonth() + delta);
            renderCalendar();
        }

        function switchView(view) {
            currentView = view;
            const listBtn = document.getElementById('view-list-btn');
            const calBtn = document.getElementById('view-calendar-btn');
            const listContainer = document.getElementById('list-view-container');
            const calContainer = document.getElementById('calendar-view-container');

            if (view === 'list') {
                listContainer.classList.remove('hidden');
                calContainer.classList.add('hidden');
                listBtn.classList.add('bg-slate-600', 'text-white', 'shadow');
                listBtn.classList.remove('text-slate-400');
                calBtn.classList.remove('bg-slate-600', 'text-white', 'shadow');
                calBtn.classList.add('text-slate-400');
            } else {
                listContainer.classList.add('hidden');
                calContainer.classList.remove('hidden');
                calBtn.classList.add('bg-slate-600', 'text-white', 'shadow');
                calBtn.classList.remove('text-slate-400');
                listBtn.classList.remove('bg-slate-600', 'text-white', 'shadow');
                listBtn.classList.add('text-slate-400');
                renderCalendar();
            }
        }

        function filterEvents(type) {
            currentFilter = type;
            document.querySelectorAll('.filter-btn').forEach(btn => {
                if(btn.id === `btn-${type}`) {
                    btn.classList.remove('text-slate-400', 'bg-transparent');
                    btn.classList.add('bg-white', 'text-slate-900', 'shadow');
                } else {
                    btn.classList.add('text-slate-400', 'bg-transparent');
                    btn.classList.remove('bg-white', 'text-slate-900', 'shadow');
                }
            });
            if (currentView === 'list') renderListView();
            else renderCalendar();
        }

        function openModal(id) {
            selectedEvent = events.find(e => e.id === id);
            if (!selectedEvent) return;

            const modal = document.getElementById('modal');
            const panel = document.getElementById('modal-panel');
            const header = document.getElementById('modal-header');
            
            document.getElementById('modal-type').innerText = selectedEvent.type.toUpperCase();
            document.getElementById('modal-title').innerText = selectedEvent.title;
            document.getElementById('modal-org').innerHTML = `<i class="fa-solid ${getBrandConfig(selectedEvent.brand).icon}"></i> ${selectedEvent.org} ${selectedEvent.isTentative ? '(Estimado)' : ''}`;
            
            let dateStr = formatDateLong(selectedEvent.dateStart);
            if(selectedEvent.dateEnd && selectedEvent.dateStart.getTime() !== selectedEvent.dateEnd.getTime()) dateStr += ` al ${formatDateLong(selectedEvent.dateEnd)}`;
            document.getElementById('modal-date').innerText = dateStr;
            document.getElementById('modal-location').innerText = selectedEvent.location;
            document.getElementById('modal-desc').innerText = selectedEvent.desc;
            document.getElementById('modal-details').innerText = selectedEvent.details;
            
            document.getElementById('modal-ig-link').href = selectedEvent.ig;
            document.getElementById('modal-action-link').href = selectedEvent.link;

            const brandConfig = getBrandConfig(selectedEvent.brand);
            header.className = `p-6 relative shrink-0 ${brandConfig.class}`;
            
            const actionBtn = document.getElementById('modal-action-link');
            actionBtn.className = `flex items-center justify-center gap-2 py-3 rounded-lg font-bold text-white shadow-lg transition transform hover:-translate-y-0.5 ${brandConfig.btn} text-sm`;
            actionBtn.innerHTML = `<span>${selectedEvent.isTentative ? 'Ver Info' : 'Inscripci√≥n'}</span> <i class="fa-solid fa-arrow-right"></i>`;

            modal.classList.remove('hidden');
            setTimeout(() => {
                panel.classList.remove('scale-95');
                panel.classList.add('scale-100');
            }, 10);
        }

        function closeModal() {
            selectedEvent = null;
            const panel = document.getElementById('modal-panel');
            panel.classList.remove('scale-100');
            panel.classList.add('scale-95');
            setTimeout(() => {
                document.getElementById('modal').classList.add('hidden');
            }, 200);
        }

        window.addEventListener('click', (e) => {
            if (e.target === document.getElementById('modal')) closeModal();
        });

        // Init
        renderListView();

    </script>
</body>
</html>


